<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>minerva: Memory</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">minerva
   &#160;<span id="projectnumber">v1.0.0</span>
   </div>
   <div id="projectbrief">GPGPU computing framework using the Vulkan API</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_memory.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Memory </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Vulkan provides many ways of allocating and presenting memory in compute shaders. <code>minerva</code> uses a subset of it to make things simpler, that should tackle most needs. The types of memory supported will be showcased in the following.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Tensor (Storage Buffer Object)</h1>
<p>Probably the most useful way to handle memory are storage buffer objects, which are represented in <code>minerva</code> by <code>Tensor</code>. The live purely in the VRAM so they are on the faster site. More importantly the support both read and write operations and can handle large sizes of data.</p>
<p>In the shader they can be defined like the following:</p>
<div class="fragment"><div class="line">layout(std430, binding = 0) buffer tensor { float x[]; };</div>
</div><!-- fragment --><p>See the official wiki for more details: <a href="https://www.khronos.org/opengl/wiki/Shader_Storage_Buffer_Object">https://www.khronos.org/opengl/wiki/Shader_Storage_Buffer_Object</a>.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Image</h1>
<p>Images are somewhat similar to storage buffer objects in that their size is also not known to the shader at compile time, but can be queried via <code>imageSize()</code>. It also lives purely in the VRAM. Its most important benefit is the more natural way to interact with data in two or three dimensions, plus the corresponding load and store functions can handle out-of-bounds calls, making explicit if guards redundant.</p>
<p>Images can have different formats, that must be defined in the declaration in the shader:</p>
<div class="fragment"><div class="line">layout(binding = 0, rgba8) uniform image2D outImage;</div>
</div><!-- fragment --><p>See the official wiki for more details: <a href="https://www.khronos.org/opengl/wiki/Image_Load_Store">https://www.khronos.org/opengl/wiki/Image_Load_Store</a></p>
<h1><a class="anchor" id="autotoc_md4"></a>
Uniform (Uniform Buffer Object)</h1>
<p>Uniform buffer object also live on the GPU (when the allocator feels like it), but are accessible by the CPU (modern GPUs usually have 256MB special memory for that). They should be a bit slower than tensors, but make the process of updating way easier. Also, they can only be read form in the shader.</p>
<p>They are defined in the shader like the following:</p>
<div class="fragment"><div class="line">layout(std140, binding = 1) uniform UBO {</div>
<div class="line">    float m11, m12, m21, m22;</div>
<div class="line">    float b1, b2;</div>
<div class="line">} ubo;</div>
</div><!-- fragment --><p>And their counterparts on the host side allows direct manipulation:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> Mat = std::array&lt;float, 4&gt;;</div>
<div class="line"><span class="keyword">using</span> Vec = std::array&lt;float, 2&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>UBO {</div>
<div class="line">    Mat m;</div>
<div class="line">    Vec b;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">constexpr UBO ubo1{ {{1.f, 0.f, 0.f, 1.f}}, {{1.f, -1.f}} };</div>
<div class="line">constexpr UBO ubo2{ {{1.f, 2.f, 2.f, 1.f}}, {{.5f, .5f}} };</div>
<div class="line"> </div>
<div class="line">Uniform&lt;UBO&gt; ubo(context, ubo1);</div>
<div class="line">*ubo = ubo2;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Push Constant</h1>
<p>Push Constant are a special type of memory. They live in the command and can be issued during calls to <code>Program::Run()</code>. They are expected to be the fastest possible, but are limited in size. Vulkan only guarentees 128 bytes(!).</p>
<p>They can be defined in the shader like the folllowing:</p>
<div class="fragment"><div class="line">layout(push_constant) uniform constants {</div>
<div class="line">    vec2 trans;</div>
<div class="line">    float scale;</div>
<div class="line">} push;</div>
</div><!-- fragment --><p>And on the host side:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Push {</div>
<div class="line">    <span class="keywordtype">float</span> transX;</div>
<div class="line">    <span class="keywordtype">float</span> transY;</div>
<div class="line">    <span class="keywordtype">float</span> scale;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// *** some other stuff ***</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> run = program.Run&lt;Push&gt;({ 16, 16, push }, param);</div>
</div><!-- fragment --><p>See the documentation of Dispatch for more details.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Buffer</h1>
<p>Buffer is special type of memory, as it lives on the host side and cant be accessed from the GPU. It's used to populate Tensor and Buffer and retrieve their data back to CPU.</p>
<p>See the <a class="el" href="md_quickstart.html">Quick Start</a> or the documentation for more details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
